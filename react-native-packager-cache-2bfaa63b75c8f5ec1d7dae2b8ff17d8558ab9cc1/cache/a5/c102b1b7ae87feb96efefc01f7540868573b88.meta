["18267ab9e62af9b952d9e6882c675ede17db4e87","9e096fe12d47464c85b39f5c8aae48304059a9be",["./onDisconnect","./TransactionResult","../core/util/util","../core/util/NextPushId","./Query","../core/Repo","../core/util/Path","../core/view/QueryParams","../core/util/validation","@firebase/util","../core/SyncPoint"],[646,699,744,793,843,876,914,964,1020,1069,1109,1154],{"version":3,"sources":["/home/giise/candidtwo/node_modules/@firebase/database/dist/cjs/src/api/Reference.js"],"names":["__extends","extendStatics","Object","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","exports","value","onDisconnect_1","require","TransactionResult_1","util_1","NextPushId_1","Query_1","Repo_1","Path_1","QueryParams_1","validation_1","util_2","util_3","SyncPoint_1","Reference","_super","repo","path","_this","Repo","Error","call","QueryParams","DEFAULT","getKey","validateArgCount","arguments","length","isEmpty","getBack","child","pathString","String","Path","getFront","validateRootPathString","validatePathString","getParent","parentPath","parent","getRoot","ref","databaseProp","database","set","newVal","onComplete","validateWritablePath","validateFirebaseDataArg","validateCallback","deferred","Deferred","setWithPriority","wrapCallback","promise","update","objectToMerge","isArray","newObjectToMerge","i","warn","validateFirebaseMergeDataArg","newPriority","validatePriority","remove","transaction","transactionUpdate","applyLocally","validateBoolean","undefined","catch","promiseComplete","error","committed","snapshot","reject","resolve","TransactionResult","startTransaction","setPriority","priority","push","now","serverTime","name","nextPushId","thennablePushRef","pushRef","then","Promise","bind","onDisconnect","OnDisconnect","get","enumerable","configurable","Query","__referenceConstructor","SyncPoint"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar onDisconnect_1 = require(\"./onDisconnect\");\nvar TransactionResult_1 = require(\"./TransactionResult\");\nvar util_1 = require(\"../core/util/util\");\nvar NextPushId_1 = require(\"../core/util/NextPushId\");\nvar Query_1 = require(\"./Query\");\nvar Repo_1 = require(\"../core/Repo\");\nvar Path_1 = require(\"../core/util/Path\");\nvar QueryParams_1 = require(\"../core/view/QueryParams\");\nvar validation_1 = require(\"../core/util/validation\");\nvar util_2 = require(\"@firebase/util\");\nvar util_3 = require(\"@firebase/util\");\nvar SyncPoint_1 = require(\"../core/SyncPoint\");\nvar Reference = /** @class */ (function (_super) {\n    __extends(Reference, _super);\n    /**\n     * Call options:\n     *   new Reference(Repo, Path) or\n     *   new Reference(url: string, string|RepoManager)\n     *\n     * Externally - this is the firebase.database.Reference type.\n     *\n     * @param {!Repo} repo\n     * @param {(!Path)} path\n     * @extends {Query}\n     */\n    function Reference(repo, path) {\n        var _this = this;\n        if (!(repo instanceof Repo_1.Repo)) {\n            throw new Error('new Reference() no longer supported - use app.database().');\n        }\n        // call Query's constructor, passing in the repo and path.\n        _this = _super.call(this, repo, path, QueryParams_1.QueryParams.DEFAULT, false) || this;\n        return _this;\n    }\n    /** @return {?string} */\n    Reference.prototype.getKey = function () {\n        util_2.validateArgCount('Reference.key', 0, 0, arguments.length);\n        if (this.path.isEmpty())\n            return null;\n        else\n            return this.path.getBack();\n    };\n    /**\n     * @param {!(string|Path)} pathString\n     * @return {!Reference}\n     */\n    Reference.prototype.child = function (pathString) {\n        util_2.validateArgCount('Reference.child', 1, 1, arguments.length);\n        if (typeof pathString === 'number') {\n            pathString = String(pathString);\n        }\n        else if (!(pathString instanceof Path_1.Path)) {\n            if (this.path.getFront() === null)\n                validation_1.validateRootPathString('Reference.child', 1, pathString, false);\n            else\n                validation_1.validatePathString('Reference.child', 1, pathString, false);\n        }\n        return new Reference(this.repo, this.path.child(pathString));\n    };\n    /** @return {?Reference} */\n    Reference.prototype.getParent = function () {\n        util_2.validateArgCount('Reference.parent', 0, 0, arguments.length);\n        var parentPath = this.path.parent();\n        return parentPath === null ? null : new Reference(this.repo, parentPath);\n    };\n    /** @return {!Reference} */\n    Reference.prototype.getRoot = function () {\n        util_2.validateArgCount('Reference.root', 0, 0, arguments.length);\n        var ref = this;\n        while (ref.getParent() !== null) {\n            ref = ref.getParent();\n        }\n        return ref;\n    };\n    /** @return {!Database} */\n    Reference.prototype.databaseProp = function () {\n        return this.repo.database;\n    };\n    /**\n     * @param {*} newVal\n     * @param {function(?Error)=} onComplete\n     * @return {!Promise}\n     */\n    Reference.prototype.set = function (newVal, onComplete) {\n        util_2.validateArgCount('Reference.set', 1, 2, arguments.length);\n        validation_1.validateWritablePath('Reference.set', this.path);\n        validation_1.validateFirebaseDataArg('Reference.set', 1, newVal, this.path, false);\n        util_2.validateCallback('Reference.set', 2, onComplete, true);\n        var deferred = new util_3.Deferred();\n        this.repo.setWithPriority(this.path, newVal, \n        /*priority=*/ null, deferred.wrapCallback(onComplete));\n        return deferred.promise;\n    };\n    /**\n     * @param {!Object} objectToMerge\n     * @param {function(?Error)=} onComplete\n     * @return {!Promise}\n     */\n    Reference.prototype.update = function (objectToMerge, onComplete) {\n        util_2.validateArgCount('Reference.update', 1, 2, arguments.length);\n        validation_1.validateWritablePath('Reference.update', this.path);\n        if (Array.isArray(objectToMerge)) {\n            var newObjectToMerge = {};\n            for (var i = 0; i < objectToMerge.length; ++i) {\n                newObjectToMerge['' + i] = objectToMerge[i];\n            }\n            objectToMerge = newObjectToMerge;\n            util_1.warn('Passing an Array to Firebase.update() is deprecated. ' +\n                'Use set() if you want to overwrite the existing data, or ' +\n                'an Object with integer keys if you really do want to ' +\n                'only update some of the children.');\n        }\n        validation_1.validateFirebaseMergeDataArg('Reference.update', 1, objectToMerge, this.path, false);\n        util_2.validateCallback('Reference.update', 2, onComplete, true);\n        var deferred = new util_3.Deferred();\n        this.repo.update(this.path, objectToMerge, deferred.wrapCallback(onComplete));\n        return deferred.promise;\n    };\n    /**\n     * @param {*} newVal\n     * @param {string|number|null} newPriority\n     * @param {function(?Error)=} onComplete\n     * @return {!Promise}\n     */\n    Reference.prototype.setWithPriority = function (newVal, newPriority, onComplete) {\n        util_2.validateArgCount('Reference.setWithPriority', 2, 3, arguments.length);\n        validation_1.validateWritablePath('Reference.setWithPriority', this.path);\n        validation_1.validateFirebaseDataArg('Reference.setWithPriority', 1, newVal, this.path, false);\n        validation_1.validatePriority('Reference.setWithPriority', 2, newPriority, false);\n        util_2.validateCallback('Reference.setWithPriority', 3, onComplete, true);\n        if (this.getKey() === '.length' || this.getKey() === '.keys')\n            throw 'Reference.setWithPriority failed: ' +\n                this.getKey() +\n                ' is a read-only object.';\n        var deferred = new util_3.Deferred();\n        this.repo.setWithPriority(this.path, newVal, newPriority, deferred.wrapCallback(onComplete));\n        return deferred.promise;\n    };\n    /**\n     * @param {function(?Error)=} onComplete\n     * @return {!Promise}\n     */\n    Reference.prototype.remove = function (onComplete) {\n        util_2.validateArgCount('Reference.remove', 0, 1, arguments.length);\n        validation_1.validateWritablePath('Reference.remove', this.path);\n        util_2.validateCallback('Reference.remove', 1, onComplete, true);\n        return this.set(null, onComplete);\n    };\n    /**\n     * @param {function(*):*} transactionUpdate\n     * @param {(function(?Error, boolean, ?DataSnapshot))=} onComplete\n     * @param {boolean=} applyLocally\n     * @return {!Promise}\n     */\n    Reference.prototype.transaction = function (transactionUpdate, onComplete, applyLocally) {\n        util_2.validateArgCount('Reference.transaction', 1, 3, arguments.length);\n        validation_1.validateWritablePath('Reference.transaction', this.path);\n        util_2.validateCallback('Reference.transaction', 1, transactionUpdate, false);\n        util_2.validateCallback('Reference.transaction', 2, onComplete, true);\n        // NOTE: applyLocally is an internal-only option for now.  We need to decide if we want to keep it and how\n        // to expose it.\n        validation_1.validateBoolean('Reference.transaction', 3, applyLocally, true);\n        if (this.getKey() === '.length' || this.getKey() === '.keys')\n            throw 'Reference.transaction failed: ' +\n                this.getKey() +\n                ' is a read-only object.';\n        if (applyLocally === undefined)\n            applyLocally = true;\n        var deferred = new util_3.Deferred();\n        if (typeof onComplete === 'function') {\n            deferred.promise.catch(function () { });\n        }\n        var promiseComplete = function (error, committed, snapshot) {\n            if (error) {\n                deferred.reject(error);\n            }\n            else {\n                deferred.resolve(new TransactionResult_1.TransactionResult(committed, snapshot));\n            }\n            if (typeof onComplete === 'function') {\n                onComplete(error, committed, snapshot);\n            }\n        };\n        this.repo.startTransaction(this.path, transactionUpdate, promiseComplete, applyLocally);\n        return deferred.promise;\n    };\n    /**\n     * @param {string|number|null} priority\n     * @param {function(?Error)=} onComplete\n     * @return {!Promise}\n     */\n    Reference.prototype.setPriority = function (priority, onComplete) {\n        util_2.validateArgCount('Reference.setPriority', 1, 2, arguments.length);\n        validation_1.validateWritablePath('Reference.setPriority', this.path);\n        validation_1.validatePriority('Reference.setPriority', 1, priority, false);\n        util_2.validateCallback('Reference.setPriority', 2, onComplete, true);\n        var deferred = new util_3.Deferred();\n        this.repo.setWithPriority(this.path.child('.priority'), priority, null, deferred.wrapCallback(onComplete));\n        return deferred.promise;\n    };\n    /**\n     * @param {*=} value\n     * @param {function(?Error)=} onComplete\n     * @return {!Reference}\n     */\n    Reference.prototype.push = function (value, onComplete) {\n        util_2.validateArgCount('Reference.push', 0, 2, arguments.length);\n        validation_1.validateWritablePath('Reference.push', this.path);\n        validation_1.validateFirebaseDataArg('Reference.push', 1, value, this.path, true);\n        util_2.validateCallback('Reference.push', 2, onComplete, true);\n        var now = this.repo.serverTime();\n        var name = NextPushId_1.nextPushId(now);\n        // push() returns a ThennableReference whose promise is fulfilled with a regular Reference.\n        // We use child() to create handles to two different references. The first is turned into a\n        // ThennableReference below by adding then() and catch() methods and is used as the\n        // return value of push(). The second remains a regular Reference and is used as the fulfilled\n        // value of the first ThennableReference.\n        var thennablePushRef = this.child(name);\n        var pushRef = this.child(name);\n        var promise;\n        if (value != null) {\n            promise = thennablePushRef.set(value, onComplete).then(function () { return pushRef; });\n        }\n        else {\n            promise = Promise.resolve(pushRef);\n        }\n        thennablePushRef.then = promise.then.bind(promise);\n        thennablePushRef.catch = promise.then.bind(promise, undefined);\n        if (typeof onComplete === 'function') {\n            promise.catch(function () { });\n        }\n        return thennablePushRef;\n    };\n    /**\n     * @return {!OnDisconnect}\n     */\n    Reference.prototype.onDisconnect = function () {\n        validation_1.validateWritablePath('Reference.onDisconnect', this.path);\n        return new onDisconnect_1.OnDisconnect(this.repo, this.path);\n    };\n    Object.defineProperty(Reference.prototype, \"database\", {\n        get: function () {\n            return this.databaseProp();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Reference.prototype, \"key\", {\n        get: function () {\n            return this.getKey();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Reference.prototype, \"parent\", {\n        get: function () {\n            return this.getParent();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Reference.prototype, \"root\", {\n        get: function () {\n            return this.getRoot();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Reference;\n}(Query_1.Query));\nexports.Reference = Reference;\n/**\n * Define reference constructor in various modules\n *\n * We are doing this here to avoid several circular\n * dependency issues\n */\nQuery_1.Query.__referenceConstructor = Reference;\nSyncPoint_1.SyncPoint.__referenceConstructor = Reference;\n\n//# sourceMappingURL=Reference.js.map\n"]}]