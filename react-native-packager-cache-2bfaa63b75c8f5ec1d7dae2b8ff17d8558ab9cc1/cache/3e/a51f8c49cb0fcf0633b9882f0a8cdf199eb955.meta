["54176cb1c45bb99ca9fbfc4808ae53fe63d5e597","81a8150a4e702c9209c8963f24158b64cab96a9a",["../../core/util/util"],[99],{"version":3,"sources":["/home/giise/candidtwo/node_modules/@firebase/database/dist/cjs/src/realtime/polling/PacketReceiver.js"],"names":["Object","defineProperty","exports","value","util_1","require","PacketReceiver","onMessage_","pendingResponses","currentResponseNum","closeAfterResponse","onClose","prototype","closeAfter","responseNum","callback","handleResponse","requestNum","data","_this","_loop_1","toProcess","this_1","_loop_2","i","exceptionGuard","length","state_1"],"mappings":"AAAA;;AAgBAA,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEC,OAAO,IAAT,EAA7C;AACA,IAAIC,SAASC,QAAQ,sBAAR,CAAb;;AAMA,IAAIC,iBAAgC,YAAY;AAI5C,aAASA,cAAT,CAAwBC,UAAxB,EAAoC;AAChC,aAAKA,UAAL,GAAkBA,UAAlB;AACA,aAAKC,gBAAL,GAAwB,EAAxB;AACA,aAAKC,kBAAL,GAA0B,CAA1B;AACA,aAAKC,kBAAL,GAA0B,CAAC,CAA3B;AACA,aAAKC,OAAL,GAAe,IAAf;AACH;AACDL,mBAAeM,SAAf,CAAyBC,UAAzB,GAAsC,UAAUC,WAAV,EAAuBC,QAAvB,EAAiC;AACnE,aAAKL,kBAAL,GAA0BI,WAA1B;AACA,aAAKH,OAAL,GAAeI,QAAf;AACA,YAAI,KAAKL,kBAAL,GAA0B,KAAKD,kBAAnC,EAAuD;AACnD,iBAAKE,OAAL;AACA,iBAAKA,OAAL,GAAe,IAAf;AACH;AACJ,KAPD;;AAeAL,mBAAeM,SAAf,CAAyBI,cAAzB,GAA0C,UAAUC,UAAV,EAAsBC,IAAtB,EAA4B;AAClE,YAAIC,QAAQ,IAAZ;AACA,aAAKX,gBAAL,CAAsBS,UAAtB,IAAoCC,IAApC;AACA,YAAIE,UAAU,SAAVA,OAAU,GAAY;AACtB,gBAAIC,YAAYC,OAAOd,gBAAP,CAAwBc,OAAOb,kBAA/B,CAAhB;AACA,mBAAOa,OAAOd,gBAAP,CAAwBc,OAAOb,kBAA/B,CAAP;AACA,gBAAIc,UAAU,SAAVA,OAAU,CAAUC,CAAV,EAAa;AACvB,oBAAIH,UAAUG,CAAV,CAAJ,EAAkB;AACdpB,2BAAOqB,cAAP,CAAsB,YAAY;AAC9BN,8BAAMZ,UAAN,CAAiBc,UAAUG,CAAV,CAAjB;AACH,qBAFD;AAGH;AACJ,aAND;AAOA,iBAAK,IAAIA,IAAI,CAAb,EAAgBA,IAAIH,UAAUK,MAA9B,EAAsC,EAAEF,CAAxC,EAA2C;AACvCD,wBAAQC,CAAR;AACH;AACD,gBAAIF,OAAOb,kBAAP,KAA8Ba,OAAOZ,kBAAzC,EAA6D;AACzD,oBAAIY,OAAOX,OAAX,EAAoB;AAChBW,2BAAOX,OAAP;AACAW,2BAAOX,OAAP,GAAiB,IAAjB;AACH;AACD,uBAAO,OAAP;AACH;AACDW,mBAAOb,kBAAP;AACH,SArBD;AAsBA,YAAIa,SAAS,IAAb;AACA,eAAO,KAAKd,gBAAL,CAAsB,KAAKC,kBAA3B,CAAP,EAAuD;AACnD,gBAAIkB,UAAUP,SAAd;AACA,gBAAIO,YAAY,OAAhB,EACI;AACP;AACJ,KA/BD;AAgCA,WAAOrB,cAAP;AACH,CA3DmC,EAApC;AA4DAJ,QAAQI,cAAR,GAAyBA,cAAzB","sourcesContent":["\"use strict\";\n/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar util_1 = require(\"../../core/util/util\");\n/**\n * This class ensures the packets from the server arrive in order\n * This class takes data from the server and ensures it gets passed into the callbacks in order.\n * @constructor\n */\nvar PacketReceiver = /** @class */ (function () {\n    /**\n     * @param onMessage_\n     */\n    function PacketReceiver(onMessage_) {\n        this.onMessage_ = onMessage_;\n        this.pendingResponses = [];\n        this.currentResponseNum = 0;\n        this.closeAfterResponse = -1;\n        this.onClose = null;\n    }\n    PacketReceiver.prototype.closeAfter = function (responseNum, callback) {\n        this.closeAfterResponse = responseNum;\n        this.onClose = callback;\n        if (this.closeAfterResponse < this.currentResponseNum) {\n            this.onClose();\n            this.onClose = null;\n        }\n    };\n    /**\n     * Each message from the server comes with a response number, and an array of data. The responseNumber\n     * allows us to ensure that we process them in the right order, since we can't be guaranteed that all\n     * browsers will respond in the same order as the requests we sent\n     * @param {number} requestNum\n     * @param {Array} data\n     */\n    PacketReceiver.prototype.handleResponse = function (requestNum, data) {\n        var _this = this;\n        this.pendingResponses[requestNum] = data;\n        var _loop_1 = function () {\n            var toProcess = this_1.pendingResponses[this_1.currentResponseNum];\n            delete this_1.pendingResponses[this_1.currentResponseNum];\n            var _loop_2 = function (i) {\n                if (toProcess[i]) {\n                    util_1.exceptionGuard(function () {\n                        _this.onMessage_(toProcess[i]);\n                    });\n                }\n            };\n            for (var i = 0; i < toProcess.length; ++i) {\n                _loop_2(i);\n            }\n            if (this_1.currentResponseNum === this_1.closeAfterResponse) {\n                if (this_1.onClose) {\n                    this_1.onClose();\n                    this_1.onClose = null;\n                }\n                return \"break\";\n            }\n            this_1.currentResponseNum++;\n        };\n        var this_1 = this;\n        while (this.pendingResponses[this.currentResponseNum]) {\n            var state_1 = _loop_1();\n            if (state_1 === \"break\")\n                break;\n        }\n    };\n    return PacketReceiver;\n}());\nexports.PacketReceiver = PacketReceiver;\n\n//# sourceMappingURL=PacketReceiver.js.map\n"]}]