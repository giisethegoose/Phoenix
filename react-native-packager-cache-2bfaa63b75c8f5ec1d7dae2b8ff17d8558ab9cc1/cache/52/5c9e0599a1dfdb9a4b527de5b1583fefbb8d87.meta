["a27b0f715af278eb42a856af726ba57553472022","2115b70babe012b8b35db43a904a04aea3ad38f7",["@firebase/util","../core/snap/indexes/KeyIndex","../core/snap/indexes/PriorityIndex","../core/snap/indexes/ValueIndex","../core/snap/indexes/PathIndex","../core/util/util","../core/util/Path","../core/util/validation","../core/view/EventRegistration"],[99,143,207,273,335,391,434,483,532,585,641],{"version":3,"sources":["/home/giise/candidtwo/node_modules/@firebase/database/dist/cjs/src/api/Query.js"],"names":["Object","defineProperty","exports","value","util_1","require","KeyIndex_1","PriorityIndex_1","ValueIndex_1","PathIndex_1","util_2","Path_1","validation_1","util_3","EventRegistration_1","util_4","__referenceConstructor","Query","repo","path","queryParams_","orderByCalled_","get","assert","set","val","enumerable","configurable","validateQueryEndpoints_","params","startNode","endNode","hasStart","getIndexStartValue","hasEnd","getIndexEndValue","getIndex","KEY_INDEX","tooManyArgsError","wrongArgTypeError","startName","getIndexStartName","MIN_NAME","Error","endName","getIndexEndName","MAX_NAME","PRIORITY_INDEX","isValidPriority","PathIndex","VALUE_INDEX","validateLimit_","hasLimit","hasAnchoredLimit","prototype","validateNoPreviousOrderByCall_","fnName","getQueryParams","getRef","validateArgCount","arguments","length","on","eventType","callback","cancelCallbackOrContext","context","validateEventType","validateCallback","ret","getCancelAndContextArgs_","onValueEvent","cancel","callbacks","onChildEvent","cancelCallback","container","ValueEventRegistration","addEventCallbackForQuery","ChildEventRegistration","off","validateContextObject","valueCallback","removeEventCallbackForQuery","once","userCallback","cancelOrContext","_this","firstCall","deferred","Deferred","promise","catch","onceCallback","snapshot","bind","resolve","err","reject","limitToFirst","limit","Math","floor","limitToLast","orderByChild","validatePathString","parsedPath","Path","isEmpty","index","newParams","orderBy","orderByKey","orderByPriority","orderByValue","startAt","name","validateFirebaseDataArg","validateKey","undefined","endAt","equalTo","toString","toUrlEncodedString","toJSON","queryObject","getQueryObject","queryIdentifier","obj","id","ObjectToUniqueKey","isEqual","other","error","sameRepo","samePath","equals","sameQueryIdentifier","errorPrefix"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar util_1 = require(\"@firebase/util\");\nvar KeyIndex_1 = require(\"../core/snap/indexes/KeyIndex\");\nvar PriorityIndex_1 = require(\"../core/snap/indexes/PriorityIndex\");\nvar ValueIndex_1 = require(\"../core/snap/indexes/ValueIndex\");\nvar PathIndex_1 = require(\"../core/snap/indexes/PathIndex\");\nvar util_2 = require(\"../core/util/util\");\nvar Path_1 = require(\"../core/util/Path\");\nvar validation_1 = require(\"../core/util/validation\");\nvar util_3 = require(\"@firebase/util\");\nvar EventRegistration_1 = require(\"../core/view/EventRegistration\");\nvar util_4 = require(\"@firebase/util\");\nvar __referenceConstructor;\n/**\n * A Query represents a filter to be applied to a firebase location.  This object purely represents the\n * query expression (and exposes our public API to build the query).  The actual query logic is in ViewBase.js.\n *\n * Since every Firebase reference is a query, Firebase inherits from this object.\n */\nvar Query = /** @class */ (function () {\n    function Query(repo, path, queryParams_, orderByCalled_) {\n        this.repo = repo;\n        this.path = path;\n        this.queryParams_ = queryParams_;\n        this.orderByCalled_ = orderByCalled_;\n    }\n    Object.defineProperty(Query, \"__referenceConstructor\", {\n        get: function () {\n            util_1.assert(__referenceConstructor, 'Reference.ts has not been loaded');\n            return __referenceConstructor;\n        },\n        set: function (val) {\n            __referenceConstructor = val;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Validates start/end values for queries.\n     * @param {!QueryParams} params\n     * @private\n     */\n    Query.validateQueryEndpoints_ = function (params) {\n        var startNode = null;\n        var endNode = null;\n        if (params.hasStart()) {\n            startNode = params.getIndexStartValue();\n        }\n        if (params.hasEnd()) {\n            endNode = params.getIndexEndValue();\n        }\n        if (params.getIndex() === KeyIndex_1.KEY_INDEX) {\n            var tooManyArgsError = 'Query: When ordering by key, you may only pass one argument to ' +\n                'startAt(), endAt(), or equalTo().';\n            var wrongArgTypeError = 'Query: When ordering by key, the argument passed to startAt(), endAt(),' +\n                'or equalTo() must be a string.';\n            if (params.hasStart()) {\n                var startName = params.getIndexStartName();\n                if (startName != util_2.MIN_NAME) {\n                    throw new Error(tooManyArgsError);\n                }\n                else if (typeof startNode !== 'string') {\n                    throw new Error(wrongArgTypeError);\n                }\n            }\n            if (params.hasEnd()) {\n                var endName = params.getIndexEndName();\n                if (endName != util_2.MAX_NAME) {\n                    throw new Error(tooManyArgsError);\n                }\n                else if (typeof endNode !== 'string') {\n                    throw new Error(wrongArgTypeError);\n                }\n            }\n        }\n        else if (params.getIndex() === PriorityIndex_1.PRIORITY_INDEX) {\n            if ((startNode != null && !validation_1.isValidPriority(startNode)) ||\n                (endNode != null && !validation_1.isValidPriority(endNode))) {\n                throw new Error('Query: When ordering by priority, the first argument passed to startAt(), ' +\n                    'endAt(), or equalTo() must be a valid priority value (null, a number, or a string).');\n            }\n        }\n        else {\n            util_1.assert(params.getIndex() instanceof PathIndex_1.PathIndex ||\n                params.getIndex() === ValueIndex_1.VALUE_INDEX, 'unknown index type.');\n            if ((startNode != null && typeof startNode === 'object') ||\n                (endNode != null && typeof endNode === 'object')) {\n                throw new Error('Query: First argument passed to startAt(), endAt(), or equalTo() cannot be ' +\n                    'an object.');\n            }\n        }\n    };\n    /**\n     * Validates that limit* has been called with the correct combination of parameters\n     * @param {!QueryParams} params\n     * @private\n     */\n    Query.validateLimit_ = function (params) {\n        if (params.hasStart() &&\n            params.hasEnd() &&\n            params.hasLimit() &&\n            !params.hasAnchoredLimit()) {\n            throw new Error(\"Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.\");\n        }\n    };\n    /**\n     * Validates that no other order by call has been made\n     * @param {!string} fnName\n     * @private\n     */\n    Query.prototype.validateNoPreviousOrderByCall_ = function (fnName) {\n        if (this.orderByCalled_ === true) {\n            throw new Error(fnName + \": You can't combine multiple orderBy calls.\");\n        }\n    };\n    /**\n     * @return {!QueryParams}\n     */\n    Query.prototype.getQueryParams = function () {\n        return this.queryParams_;\n    };\n    /**\n     * @return {!Reference}\n     */\n    Query.prototype.getRef = function () {\n        util_3.validateArgCount('Query.ref', 0, 0, arguments.length);\n        // This is a slight hack. We cannot goog.require('fb.api.Firebase'), since Firebase requires fb.api.Query.\n        // However, we will always export 'Firebase' to the global namespace, so it's guaranteed to exist by the time this\n        // method gets called.\n        return new Query.__referenceConstructor(this.repo, this.path);\n    };\n    /**\n     * @param {!string} eventType\n     * @param {!function(DataSnapshot, string=)} callback\n     * @param {(function(Error)|Object)=} cancelCallbackOrContext\n     * @param {Object=} context\n     * @return {!function(DataSnapshot, string=)}\n     */\n    Query.prototype.on = function (eventType, callback, cancelCallbackOrContext, context) {\n        util_3.validateArgCount('Query.on', 2, 4, arguments.length);\n        validation_1.validateEventType('Query.on', 1, eventType, false);\n        util_3.validateCallback('Query.on', 2, callback, false);\n        var ret = Query.getCancelAndContextArgs_('Query.on', cancelCallbackOrContext, context);\n        if (eventType === 'value') {\n            this.onValueEvent(callback, ret.cancel, ret.context);\n        }\n        else {\n            var callbacks = {};\n            callbacks[eventType] = callback;\n            this.onChildEvent(callbacks, ret.cancel, ret.context);\n        }\n        return callback;\n    };\n    /**\n     * @param {!function(!DataSnapshot)} callback\n     * @param {?function(Error)} cancelCallback\n     * @param {?Object} context\n     * @protected\n     */\n    Query.prototype.onValueEvent = function (callback, cancelCallback, context) {\n        var container = new EventRegistration_1.ValueEventRegistration(callback, cancelCallback || null, context || null);\n        this.repo.addEventCallbackForQuery(this, container);\n    };\n    /**\n     * @param {!Object.<string, !function(!DataSnapshot, ?string)>} callbacks\n     * @param {?function(Error)} cancelCallback\n     * @param {?Object} context\n     * @protected\n     */\n    Query.prototype.onChildEvent = function (callbacks, cancelCallback, context) {\n        var container = new EventRegistration_1.ChildEventRegistration(callbacks, cancelCallback, context);\n        this.repo.addEventCallbackForQuery(this, container);\n    };\n    /**\n     * @param {string=} eventType\n     * @param {(function(!DataSnapshot, ?string=))=} callback\n     * @param {Object=} context\n     */\n    Query.prototype.off = function (eventType, callback, context) {\n        util_3.validateArgCount('Query.off', 0, 3, arguments.length);\n        validation_1.validateEventType('Query.off', 1, eventType, true);\n        util_3.validateCallback('Query.off', 2, callback, true);\n        util_3.validateContextObject('Query.off', 3, context, true);\n        var container = null;\n        var callbacks = null;\n        if (eventType === 'value') {\n            var valueCallback = callback || null;\n            container = new EventRegistration_1.ValueEventRegistration(valueCallback, null, context || null);\n        }\n        else if (eventType) {\n            if (callback) {\n                callbacks = {};\n                callbacks[eventType] = callback;\n            }\n            container = new EventRegistration_1.ChildEventRegistration(callbacks, null, context || null);\n        }\n        this.repo.removeEventCallbackForQuery(this, container);\n    };\n    /**\n     * Attaches a listener, waits for the first event, and then removes the listener\n     * @param {!string} eventType\n     * @param {!function(!DataSnapshot, string=)} userCallback\n     * @param cancelOrContext\n     * @param context\n     * @return {!firebase.Promise}\n     */\n    Query.prototype.once = function (eventType, userCallback, cancelOrContext, context) {\n        var _this = this;\n        util_3.validateArgCount('Query.once', 1, 4, arguments.length);\n        validation_1.validateEventType('Query.once', 1, eventType, false);\n        util_3.validateCallback('Query.once', 2, userCallback, true);\n        var ret = Query.getCancelAndContextArgs_('Query.once', cancelOrContext, context);\n        // TODO: Implement this more efficiently (in particular, use 'get' wire protocol for 'value' event)\n        // TODO: consider actually wiring the callbacks into the promise. We cannot do this without a breaking change\n        // because the API currently expects callbacks will be called synchronously if the data is cached, but this is\n        // against the Promise specification.\n        var firstCall = true;\n        var deferred = new util_4.Deferred();\n        // A dummy error handler in case a user wasn't expecting promises\n        deferred.promise.catch(function () { });\n        var onceCallback = function (snapshot) {\n            // NOTE: Even though we unsubscribe, we may get called multiple times if a single action (e.g. set() with JSON)\n            // triggers multiple events (e.g. child_added or child_changed).\n            if (firstCall) {\n                firstCall = false;\n                _this.off(eventType, onceCallback);\n                if (userCallback) {\n                    userCallback.bind(ret.context)(snapshot);\n                }\n                deferred.resolve(snapshot);\n            }\n        };\n        this.on(eventType, onceCallback, \n        /*cancel=*/ function (err) {\n            _this.off(eventType, onceCallback);\n            if (ret.cancel)\n                ret.cancel.bind(ret.context)(err);\n            deferred.reject(err);\n        });\n        return deferred.promise;\n    };\n    /**\n     * Set a limit and anchor it to the start of the window.\n     * @param {!number} limit\n     * @return {!Query}\n     */\n    Query.prototype.limitToFirst = function (limit) {\n        util_3.validateArgCount('Query.limitToFirst', 1, 1, arguments.length);\n        if (typeof limit !== 'number' ||\n            Math.floor(limit) !== limit ||\n            limit <= 0) {\n            throw new Error('Query.limitToFirst: First argument must be a positive integer.');\n        }\n        if (this.queryParams_.hasLimit()) {\n            throw new Error('Query.limitToFirst: Limit was already set (by another call to limit, ' +\n                'limitToFirst, or limitToLast).');\n        }\n        return new Query(this.repo, this.path, this.queryParams_.limitToFirst(limit), this.orderByCalled_);\n    };\n    /**\n     * Set a limit and anchor it to the end of the window.\n     * @param {!number} limit\n     * @return {!Query}\n     */\n    Query.prototype.limitToLast = function (limit) {\n        util_3.validateArgCount('Query.limitToLast', 1, 1, arguments.length);\n        if (typeof limit !== 'number' ||\n            Math.floor(limit) !== limit ||\n            limit <= 0) {\n            throw new Error('Query.limitToLast: First argument must be a positive integer.');\n        }\n        if (this.queryParams_.hasLimit()) {\n            throw new Error('Query.limitToLast: Limit was already set (by another call to limit, ' +\n                'limitToFirst, or limitToLast).');\n        }\n        return new Query(this.repo, this.path, this.queryParams_.limitToLast(limit), this.orderByCalled_);\n    };\n    /**\n     * Given a child path, return a new query ordered by the specified grandchild path.\n     * @param {!string} path\n     * @return {!Query}\n     */\n    Query.prototype.orderByChild = function (path) {\n        util_3.validateArgCount('Query.orderByChild', 1, 1, arguments.length);\n        if (path === '$key') {\n            throw new Error('Query.orderByChild: \"$key\" is invalid.  Use Query.orderByKey() instead.');\n        }\n        else if (path === '$priority') {\n            throw new Error('Query.orderByChild: \"$priority\" is invalid.  Use Query.orderByPriority() instead.');\n        }\n        else if (path === '$value') {\n            throw new Error('Query.orderByChild: \"$value\" is invalid.  Use Query.orderByValue() instead.');\n        }\n        validation_1.validatePathString('Query.orderByChild', 1, path, false);\n        this.validateNoPreviousOrderByCall_('Query.orderByChild');\n        var parsedPath = new Path_1.Path(path);\n        if (parsedPath.isEmpty()) {\n            throw new Error('Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.');\n        }\n        var index = new PathIndex_1.PathIndex(parsedPath);\n        var newParams = this.queryParams_.orderBy(index);\n        Query.validateQueryEndpoints_(newParams);\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\n    };\n    /**\n     * Return a new query ordered by the KeyIndex\n     * @return {!Query}\n     */\n    Query.prototype.orderByKey = function () {\n        util_3.validateArgCount('Query.orderByKey', 0, 0, arguments.length);\n        this.validateNoPreviousOrderByCall_('Query.orderByKey');\n        var newParams = this.queryParams_.orderBy(KeyIndex_1.KEY_INDEX);\n        Query.validateQueryEndpoints_(newParams);\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\n    };\n    /**\n     * Return a new query ordered by the PriorityIndex\n     * @return {!Query}\n     */\n    Query.prototype.orderByPriority = function () {\n        util_3.validateArgCount('Query.orderByPriority', 0, 0, arguments.length);\n        this.validateNoPreviousOrderByCall_('Query.orderByPriority');\n        var newParams = this.queryParams_.orderBy(PriorityIndex_1.PRIORITY_INDEX);\n        Query.validateQueryEndpoints_(newParams);\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\n    };\n    /**\n     * Return a new query ordered by the ValueIndex\n     * @return {!Query}\n     */\n    Query.prototype.orderByValue = function () {\n        util_3.validateArgCount('Query.orderByValue', 0, 0, arguments.length);\n        this.validateNoPreviousOrderByCall_('Query.orderByValue');\n        var newParams = this.queryParams_.orderBy(ValueIndex_1.VALUE_INDEX);\n        Query.validateQueryEndpoints_(newParams);\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\n    };\n    /**\n     * @param {number|string|boolean|null} value\n     * @param {?string=} name\n     * @return {!Query}\n     */\n    Query.prototype.startAt = function (value, name) {\n        if (value === void 0) { value = null; }\n        util_3.validateArgCount('Query.startAt', 0, 2, arguments.length);\n        validation_1.validateFirebaseDataArg('Query.startAt', 1, value, this.path, true);\n        validation_1.validateKey('Query.startAt', 2, name, true);\n        var newParams = this.queryParams_.startAt(value, name);\n        Query.validateLimit_(newParams);\n        Query.validateQueryEndpoints_(newParams);\n        if (this.queryParams_.hasStart()) {\n            throw new Error('Query.startAt: Starting point was already set (by another call to startAt ' +\n                'or equalTo).');\n        }\n        // Calling with no params tells us to start at the beginning.\n        if (value === undefined) {\n            value = null;\n            name = null;\n        }\n        return new Query(this.repo, this.path, newParams, this.orderByCalled_);\n    };\n    /**\n     * @param {number|string|boolean|null} value\n     * @param {?string=} name\n     * @return {!Query}\n     */\n    Query.prototype.endAt = function (value, name) {\n        if (value === void 0) { value = null; }\n        util_3.validateArgCount('Query.endAt', 0, 2, arguments.length);\n        validation_1.validateFirebaseDataArg('Query.endAt', 1, value, this.path, true);\n        validation_1.validateKey('Query.endAt', 2, name, true);\n        var newParams = this.queryParams_.endAt(value, name);\n        Query.validateLimit_(newParams);\n        Query.validateQueryEndpoints_(newParams);\n        if (this.queryParams_.hasEnd()) {\n            throw new Error('Query.endAt: Ending point was already set (by another call to endAt or ' +\n                'equalTo).');\n        }\n        return new Query(this.repo, this.path, newParams, this.orderByCalled_);\n    };\n    /**\n     * Load the selection of children with exactly the specified value, and, optionally,\n     * the specified name.\n     * @param {number|string|boolean|null} value\n     * @param {string=} name\n     * @return {!Query}\n     */\n    Query.prototype.equalTo = function (value, name) {\n        util_3.validateArgCount('Query.equalTo', 1, 2, arguments.length);\n        validation_1.validateFirebaseDataArg('Query.equalTo', 1, value, this.path, false);\n        validation_1.validateKey('Query.equalTo', 2, name, true);\n        if (this.queryParams_.hasStart()) {\n            throw new Error('Query.equalTo: Starting point was already set (by another call to startAt or ' +\n                'equalTo).');\n        }\n        if (this.queryParams_.hasEnd()) {\n            throw new Error('Query.equalTo: Ending point was already set (by another call to endAt or ' +\n                'equalTo).');\n        }\n        return this.startAt(value, name).endAt(value, name);\n    };\n    /**\n     * @return {!string} URL for this location.\n     */\n    Query.prototype.toString = function () {\n        util_3.validateArgCount('Query.toString', 0, 0, arguments.length);\n        return this.repo.toString() + this.path.toUrlEncodedString();\n    };\n    // Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\n    // for end-users.\n    Query.prototype.toJSON = function () {\n        // An optional spacer argument is unnecessary for a string.\n        util_3.validateArgCount('Query.toJSON', 0, 1, arguments.length);\n        return this.toString();\n    };\n    /**\n     * An object representation of the query parameters used by this Query.\n     * @return {!Object}\n     */\n    Query.prototype.queryObject = function () {\n        return this.queryParams_.getQueryObject();\n    };\n    /**\n     * @return {!string}\n     */\n    Query.prototype.queryIdentifier = function () {\n        var obj = this.queryObject();\n        var id = util_2.ObjectToUniqueKey(obj);\n        return id === '{}' ? 'default' : id;\n    };\n    /**\n     * Return true if this query and the provided query are equivalent; otherwise, return false.\n     * @param {Query} other\n     * @return {boolean}\n     */\n    Query.prototype.isEqual = function (other) {\n        util_3.validateArgCount('Query.isEqual', 1, 1, arguments.length);\n        if (!(other instanceof Query)) {\n            var error = 'Query.isEqual failed: First argument must be an instance of firebase.database.Query.';\n            throw new Error(error);\n        }\n        var sameRepo = this.repo === other.repo;\n        var samePath = this.path.equals(other.path);\n        var sameQueryIdentifier = this.queryIdentifier() === other.queryIdentifier();\n        return sameRepo && samePath && sameQueryIdentifier;\n    };\n    /**\n     * Helper used by .on and .once to extract the context and or cancel arguments.\n     * @param {!string} fnName The function name (on or once)\n     * @param {(function(Error)|Object)=} cancelOrContext\n     * @param {Object=} context\n     * @return {{cancel: ?function(Error), context: ?Object}}\n     * @private\n     */\n    Query.getCancelAndContextArgs_ = function (fnName, cancelOrContext, context) {\n        var ret = { cancel: null, context: null };\n        if (cancelOrContext && context) {\n            ret.cancel = cancelOrContext;\n            util_3.validateCallback(fnName, 3, ret.cancel, true);\n            ret.context = context;\n            util_3.validateContextObject(fnName, 4, ret.context, true);\n        }\n        else if (cancelOrContext) {\n            // we have either a cancel callback or a context.\n            if (typeof cancelOrContext === 'object' && cancelOrContext !== null) {\n                // it's a context!\n                ret.context = cancelOrContext;\n            }\n            else if (typeof cancelOrContext === 'function') {\n                ret.cancel = cancelOrContext;\n            }\n            else {\n                throw new Error(util_3.errorPrefix(fnName, 3, true) +\n                    ' must either be a cancel callback or a context object.');\n            }\n        }\n        return ret;\n    };\n    Object.defineProperty(Query.prototype, \"ref\", {\n        get: function () {\n            return this.getRef();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Query;\n}());\nexports.Query = Query;\n\n//# sourceMappingURL=Query.js.map\n"]}]