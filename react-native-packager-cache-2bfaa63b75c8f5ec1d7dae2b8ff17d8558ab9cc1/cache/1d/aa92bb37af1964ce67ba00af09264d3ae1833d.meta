["c8d59bf4c7d2292fabe25e6ec322046bf73b90bb","ffe8b1e0aa68a37dbf2ff5937ad73eafba79b6ff",["./BrowserPollConnection","./WebSocketConnection","../core/util/util"],[116,180,227],{"version":3,"sources":["/home/giise/candidtwo/node_modules/@firebase/database/dist/cjs/src/realtime/TransportManager.js"],"names":["Object","defineProperty","exports","value","BrowserPollConnection_1","require","WebSocketConnection_1","util_1","TransportManager","repoInfo","initTransports_","get","BrowserPollConnection","WebSocketConnection","enumerable","configurable","prototype","isWebSocketsAvailable","isSkipPollConnection","previouslyFailed","webSocketOnly","warn","transports_","transports_1","each","ALL_TRANSPORTS","i","transport","push","initialTransport","length","Error","upgradeTransport"],"mappings":"AAAA;;AAgBAA,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEC,OAAO,IAAT,EAA7C;AACA,IAAIC,0BAA0BC,QAAQ,yBAAR,CAA9B;AACA,IAAIC,wBAAwBD,QAAQ,uBAAR,CAA5B;AACA,IAAIE,SAASF,QAAQ,mBAAR,CAAb;;AASA,IAAIG,mBAAkC,YAAY;AAI9C,aAASA,gBAAT,CAA0BC,QAA1B,EAAoC;AAChC,aAAKC,eAAL,CAAqBD,QAArB;AACH;AACDT,WAAOC,cAAP,CAAsBO,gBAAtB,EAAwC,gBAAxC,EAA0D;AAKtDG,aAAK,eAAY;AACb,mBAAO,CAACP,wBAAwBQ,qBAAzB,EAAgDN,sBAAsBO,mBAAtE,CAAP;AACH,SAPqD;AAQtDC,oBAAY,IAR0C;AAStDC,sBAAc;AATwC,KAA1D;;AAeAP,qBAAiBQ,SAAjB,CAA2BN,eAA3B,GAA6C,UAAUD,QAAV,EAAoB;AAC7D,YAAIQ,wBAAwBX,sBAAsBO,mBAAtB,IAA6CP,sBAAsBO,mBAAtB,CAA0C,aAA1C,GAAzE;AACA,YAAIK,uBAAuBD,yBAAyB,CAACX,sBAAsBO,mBAAtB,CAA0CM,gBAA1C,EAArD;AACA,YAAIV,SAASW,aAAb,EAA4B;AACxB,gBAAI,CAACH,qBAAL,EACIV,OAAOc,IAAP,CAAY,iFAAZ;AACJH,mCAAuB,IAAvB;AACH;AACD,YAAIA,oBAAJ,EAA0B;AACtB,iBAAKI,WAAL,GAAmB,CAAChB,sBAAsBO,mBAAvB,CAAnB;AACH,SAFD,MAGK;AACD,gBAAIU,eAAgB,KAAKD,WAAL,GAAmB,EAAvC;AACAf,mBAAOiB,IAAP,CAAYhB,iBAAiBiB,cAA7B,EAA6C,UAAUC,CAAV,EAAaC,SAAb,EAAwB;AACjE,oBAAIA,aAAaA,UAAU,aAAV,GAAjB,EAA6C;AACzCJ,iCAAaK,IAAb,CAAkBD,SAAlB;AACH;AACJ,aAJD;AAKH;AACJ,KAnBD;;AAwBAnB,qBAAiBQ,SAAjB,CAA2Ba,gBAA3B,GAA8C,YAAY;AACtD,YAAI,KAAKP,WAAL,CAAiBQ,MAAjB,GAA0B,CAA9B,EAAiC;AAC7B,mBAAO,KAAKR,WAAL,CAAiB,CAAjB,CAAP;AACH,SAFD,MAGK;AACD,kBAAM,IAAIS,KAAJ,CAAU,yBAAV,CAAN;AACH;AACJ,KAPD;;AAYAvB,qBAAiBQ,SAAjB,CAA2BgB,gBAA3B,GAA8C,YAAY;AACtD,YAAI,KAAKV,WAAL,CAAiBQ,MAAjB,GAA0B,CAA9B,EAAiC;AAC7B,mBAAO,KAAKR,WAAL,CAAiB,CAAjB,CAAP;AACH,SAFD,MAGK;AACD,mBAAO,IAAP;AACH;AACJ,KAPD;AAQA,WAAOd,gBAAP;AACH,CAnEqC,EAAtC;AAoEAN,QAAQM,gBAAR,GAA2BA,gBAA3B","sourcesContent":["\"use strict\";\n/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar BrowserPollConnection_1 = require(\"./BrowserPollConnection\");\nvar WebSocketConnection_1 = require(\"./WebSocketConnection\");\nvar util_1 = require(\"../core/util/util\");\n/**\n * Currently simplistic, this class manages what transport a Connection should use at various stages of its\n * lifecycle.\n *\n * It starts with longpolling in a browser, and httppolling on node. It then upgrades to websockets if\n * they are available.\n * @constructor\n */\nvar TransportManager = /** @class */ (function () {\n    /**\n     * @param {!RepoInfo} repoInfo Metadata around the namespace we're connecting to\n     */\n    function TransportManager(repoInfo) {\n        this.initTransports_(repoInfo);\n    }\n    Object.defineProperty(TransportManager, \"ALL_TRANSPORTS\", {\n        /**\n         * @const\n         * @type {!Array.<function(new:Transport, string, RepoInfo, string=)>}\n         */\n        get: function () {\n            return [BrowserPollConnection_1.BrowserPollConnection, WebSocketConnection_1.WebSocketConnection];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * @param {!RepoInfo} repoInfo\n     * @private\n     */\n    TransportManager.prototype.initTransports_ = function (repoInfo) {\n        var isWebSocketsAvailable = WebSocketConnection_1.WebSocketConnection && WebSocketConnection_1.WebSocketConnection['isAvailable']();\n        var isSkipPollConnection = isWebSocketsAvailable && !WebSocketConnection_1.WebSocketConnection.previouslyFailed();\n        if (repoInfo.webSocketOnly) {\n            if (!isWebSocketsAvailable)\n                util_1.warn(\"wss:// URL used, but browser isn't known to support websockets.  Trying anyway.\");\n            isSkipPollConnection = true;\n        }\n        if (isSkipPollConnection) {\n            this.transports_ = [WebSocketConnection_1.WebSocketConnection];\n        }\n        else {\n            var transports_1 = (this.transports_ = []);\n            util_1.each(TransportManager.ALL_TRANSPORTS, function (i, transport) {\n                if (transport && transport['isAvailable']()) {\n                    transports_1.push(transport);\n                }\n            });\n        }\n    };\n    /**\n     * @return {function(new:Transport, !string, !RepoInfo, string=, string=)} The constructor for the\n     * initial transport to use\n     */\n    TransportManager.prototype.initialTransport = function () {\n        if (this.transports_.length > 0) {\n            return this.transports_[0];\n        }\n        else {\n            throw new Error('No transports available');\n        }\n    };\n    /**\n     * @return {?function(new:Transport, function(),function(), string=)} The constructor for the next\n     * transport, or null\n     */\n    TransportManager.prototype.upgradeTransport = function () {\n        if (this.transports_.length > 1) {\n            return this.transports_[1];\n        }\n        else {\n            return null;\n        }\n    };\n    return TransportManager;\n}());\nexports.TransportManager = TransportManager;\n\n//# sourceMappingURL=TransportManager.js.map\n"]}]