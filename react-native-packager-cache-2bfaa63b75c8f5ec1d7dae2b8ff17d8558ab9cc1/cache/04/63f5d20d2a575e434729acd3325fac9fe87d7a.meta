["c39c7fbd4a9d59c28e53e5bdec1bf9c1059a7656","8c452f13595aa87572d1a7a37ce3e88e0e4b6e6a",["./json","./location","./path","./type","./url"],[97,133,167,197,231],{"version":3,"sources":["/home/giise/candidtwo/node_modules/@firebase/storage/dist/cjs/src/implementation/metadata.js"],"names":["Object","defineProperty","exports","value","json","require","location_1","path","type","UrlUtils","noXform_","metadata","Mapping","server","opt_local","opt_writable","opt_xform","local","writable","xform","mappings_","xformPath","fullPath","valid","isString","length","lastComponent","getMappings","mappings","push","mappingsXformPath","nameMapping","xformSize","size","isDef","sizeMapping","xformTokens","tokens","encode","encodeURIComponent","tokensList","split","urls","map","token","bucket","urlPart","base","makeDownloadUrl","queryString","makeQueryString","alt","addRef","authWrapper","generateRef","loc","Location","makeStorageReference","get","fromResource","resource","len","i","mapping","fromResourceString","resourceString","obj","jsonObjectOrNull","toResourceString","JSON","stringify","metadataValidator","p","validType","isObject","key","val","isNonNullObject"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar json = require(\"./json\");\nvar location_1 = require(\"./location\");\nvar path = require(\"./path\");\nvar type = require(\"./type\");\nvar UrlUtils = require(\"./url\");\nfunction noXform_(metadata, value) {\n    return value;\n}\nexports.noXform_ = noXform_;\n/**\n * @struct\n */\nvar Mapping = /** @class */ (function () {\n    function Mapping(server, opt_local, opt_writable, opt_xform) {\n        this.server = server;\n        this.local = opt_local || server;\n        this.writable = !!opt_writable;\n        this.xform = opt_xform || noXform_;\n    }\n    return Mapping;\n}());\nexports.Mapping = Mapping;\nvar mappings_ = null;\nfunction xformPath(fullPath) {\n    var valid = type.isString(fullPath);\n    if (!valid || fullPath.length < 2) {\n        return fullPath;\n    }\n    else {\n        fullPath = fullPath;\n        return path.lastComponent(fullPath);\n    }\n}\nexports.xformPath = xformPath;\nfunction getMappings() {\n    if (mappings_) {\n        return mappings_;\n    }\n    var mappings = [];\n    mappings.push(new Mapping('bucket'));\n    mappings.push(new Mapping('generation'));\n    mappings.push(new Mapping('metageneration'));\n    mappings.push(new Mapping('name', 'fullPath', true));\n    function mappingsXformPath(metadata, fullPath) {\n        return xformPath(fullPath);\n    }\n    var nameMapping = new Mapping('name');\n    nameMapping.xform = mappingsXformPath;\n    mappings.push(nameMapping);\n    /**\n     * Coerces the second param to a number, if it is defined.\n     */\n    function xformSize(metadata, size) {\n        if (type.isDef(size)) {\n            return +size;\n        }\n        else {\n            return size;\n        }\n    }\n    var sizeMapping = new Mapping('size');\n    sizeMapping.xform = xformSize;\n    mappings.push(sizeMapping);\n    mappings.push(new Mapping('timeCreated'));\n    mappings.push(new Mapping('updated'));\n    mappings.push(new Mapping('md5Hash', null, true));\n    mappings.push(new Mapping('cacheControl', null, true));\n    mappings.push(new Mapping('contentDisposition', null, true));\n    mappings.push(new Mapping('contentEncoding', null, true));\n    mappings.push(new Mapping('contentLanguage', null, true));\n    mappings.push(new Mapping('contentType', null, true));\n    mappings.push(new Mapping('metadata', 'customMetadata', true));\n    /**\n     * Transforms a comma-separated string of tokens into a list of download\n     * URLs.\n     */\n    function xformTokens(metadata, tokens) {\n        var valid = type.isString(tokens) && tokens.length > 0;\n        if (!valid) {\n            // This can happen if objects are uploaded through GCS and retrieved\n            // through list, so we don't want to throw an Error.\n            return [];\n        }\n        var encode = encodeURIComponent;\n        var tokensList = tokens.split(',');\n        var urls = tokensList.map(function (token) {\n            var bucket = metadata['bucket'];\n            var path = metadata['fullPath'];\n            var urlPart = '/b/' + encode(bucket) + '/o/' + encode(path);\n            var base = UrlUtils.makeDownloadUrl(urlPart);\n            var queryString = UrlUtils.makeQueryString({\n                alt: 'media',\n                token: token\n            });\n            return base + queryString;\n        });\n        return urls;\n    }\n    mappings.push(new Mapping('downloadTokens', 'downloadURLs', false, xformTokens));\n    mappings_ = mappings;\n    return mappings_;\n}\nexports.getMappings = getMappings;\nfunction addRef(metadata, authWrapper) {\n    function generateRef() {\n        var bucket = metadata['bucket'];\n        var path = metadata['fullPath'];\n        var loc = new location_1.Location(bucket, path);\n        return authWrapper.makeStorageReference(loc);\n    }\n    Object.defineProperty(metadata, 'ref', { get: generateRef });\n}\nexports.addRef = addRef;\nfunction fromResource(authWrapper, resource, mappings) {\n    var metadata = {};\n    metadata['type'] = 'file';\n    var len = mappings.length;\n    for (var i = 0; i < len; i++) {\n        var mapping = mappings[i];\n        metadata[mapping.local] = mapping.xform(metadata, resource[mapping.server]);\n    }\n    addRef(metadata, authWrapper);\n    return metadata;\n}\nexports.fromResource = fromResource;\nfunction fromResourceString(authWrapper, resourceString, mappings) {\n    var obj = json.jsonObjectOrNull(resourceString);\n    if (obj === null) {\n        return null;\n    }\n    var resource = obj;\n    return fromResource(authWrapper, resource, mappings);\n}\nexports.fromResourceString = fromResourceString;\nfunction toResourceString(metadata, mappings) {\n    var resource = {};\n    var len = mappings.length;\n    for (var i = 0; i < len; i++) {\n        var mapping = mappings[i];\n        if (mapping.writable) {\n            resource[mapping.server] = metadata[mapping.local];\n        }\n    }\n    return JSON.stringify(resource);\n}\nexports.toResourceString = toResourceString;\nfunction metadataValidator(p) {\n    var validType = p && type.isObject(p);\n    if (!validType) {\n        throw 'Expected Metadata object.';\n    }\n    for (var key in p) {\n        var val = p[key];\n        if (key === 'customMetadata') {\n            if (!type.isObject(val)) {\n                throw 'Expected object for \\'customMetadata\\' mapping.';\n            }\n        }\n        else {\n            if (type.isNonNullObject(val)) {\n                throw \"Mapping for '\" + key + \"' cannot be an object.\";\n            }\n        }\n    }\n}\nexports.metadataValidator = metadataValidator;\n\n//# sourceMappingURL=metadata.js.map\n"]}]